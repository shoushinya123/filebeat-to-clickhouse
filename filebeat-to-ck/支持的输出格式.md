# Filebeat è¾“å‡ºæ ¼å¼æ”¯æŒè¯´æ˜

## âœ… å·²å®Œå…¨æ”¯æŒ

### 1. Elasticsearch è¾“å‡º (`output.elasticsearch`)
- **çŠ¶æ€**: âœ… å®Œå…¨æ”¯æŒ
- **åè®®**: HTTP + Elasticsearch Bulk API
- **ç«¯ç‚¹**: `POST /_bulk`, `POST /:index/_bulk`
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  output.elasticsearch:
    hosts: ["http://filebeat-to-ck:8080"]
    index: "filebeat-%{+yyyy.MM.dd}"
  ```

### 2. Logstash HTTP è¾“å‡º (`output.logstash` with HTTP)
- **çŠ¶æ€**: âœ… å®Œå…¨æ”¯æŒ
- **åè®®**: HTTP + JSON
- **ç«¯ç‚¹**: `POST /`, `POST /logstash`
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  output.logstash:
    hosts: ["filebeat-to-ck:8080"]
    # æ³¨æ„ï¼šéœ€è¦ Logstash é…ç½®ä¸º HTTP è¾“å‡º
  ```

### 3. ç›´æ¥ JSON æ¥æ”¶
- **çŠ¶æ€**: âœ… å®Œå…¨æ”¯æŒ
- **åè®®**: HTTP + JSON
- **ç«¯ç‚¹**: 
  - `POST /events` - JSON æ•°ç»„
  - `POST /filebeat` - å•ä¸ª JSON å¯¹è±¡
  - `POST /ingest` - é€šç”¨æ¥æ”¶ç«¯ç‚¹

## ğŸš§ éƒ¨åˆ†æ”¯æŒï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰

### 4. Logstash TCP è¾“å‡º (`output.logstash` with TCP)
- **çŠ¶æ€**: ğŸš§ æ¡†æ¶å·²å‡†å¤‡ï¼Œéœ€è¦å®ç° Lumberjack/Beats protocol
- **åè®®**: TCP + Lumberjack/Beats protocol
- **ç«¯å£**: 5044 (å¯é…ç½®)
- **è¯´æ˜**: Lumberjack æ˜¯äºŒè¿›åˆ¶åè®®ï¼Œéœ€è¦ä¸“é—¨çš„åº“è§£æ
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  output.logstash:
    hosts: ["filebeat-to-ck:5044"]
  ```

### 5. Kafka è¾“å‡º (`output.kafka`)
- **çŠ¶æ€**: ğŸš§ æ¡†æ¶å·²å‡†å¤‡ï¼Œéœ€è¦å®ç° Kafka consumer
- **åè®®**: Kafka protocol
- **è¯´æ˜**: éœ€è¦æ·»åŠ  Kafka consumer å®ç°
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  output.kafka:
    hosts: ["kafka:9092"]
    topic: "filebeat"
  ```
  è½¬æ¢å™¨é…ç½®:
  ```yaml
  inputs:
    kafka:
      enabled: true
      brokers: ["kafka:9092"]
      topics: ["filebeat"]
      group_id: "filebeat-to-ck"
  ```

### 6. Redis è¾“å‡º (`output.redis`)
- **çŠ¶æ€**: ğŸš§ æ¡†æ¶å·²å‡†å¤‡ï¼Œéœ€è¦å®ç° Redis consumer
- **åè®®**: Redis LIST æˆ– PUBSUB
- **è¯´æ˜**: éœ€è¦æ·»åŠ  Redis client å®ç°
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  output.redis:
    hosts: ["redis:6379"]
    key: "filebeat:logs"
    data_type: "list"  # æˆ– "channel"
  ```
  è½¬æ¢å™¨é…ç½®:
  ```yaml
  inputs:
    redis:
      enabled: true
      address: "redis:6379"
      mode: "list"  # æˆ– "pubsub"
      key: "filebeat:logs"
  ```

### 7. File è¾“å‡º (`output.file`)
- **çŠ¶æ€**: ğŸš§ æ¡†æ¶å·²å‡†å¤‡ï¼Œéœ€è¦å®ç°æ–‡ä»¶ tail
- **åè®®**: æ–‡ä»¶ç³»ç»Ÿ
- **è¯´æ˜**: éœ€è¦æ·»åŠ æ–‡ä»¶ç›‘æ§å’Œ tail åŠŸèƒ½
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  output.file:
    path: "/var/log/filebeat/output.log"
    filename: "filebeat"
  ```
  è½¬æ¢å™¨é…ç½®:
  ```yaml
  inputs:
    file:
      enabled: true
      paths: ["/var/log/filebeat/*.log"]
      follow: true
  ```

### 8. Console è¾“å‡º (`output.console`)
- **çŠ¶æ€**: ğŸš§ éœ€è¦å¤–éƒ¨å·¥å…·é…åˆ
- **åè®®**: æ ‡å‡†è¾“å‡º
- **è¯´æ˜**: å¯ä»¥é€šè¿‡ç®¡é“æˆ–é‡å®šå‘åˆ° HTTP æ¥å£
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  output.console:
    enabled: true
    codec.json:
      pretty: false
  ```
  ä½¿ç”¨æ–¹å¼:
  ```bash
  filebeat | curl -X POST http://filebeat-to-ck:8080/ingest -H "Content-Type: application/json" -d @-
  ```

## ğŸ“‹ ä½¿ç”¨å»ºè®®

### æ¨èæ–¹æ¡ˆï¼ˆå·²å®Œå…¨æ”¯æŒï¼‰

1. **Elasticsearch è¾“å‡º**ï¼ˆæ¨èï¼‰
   - æœ€ç®€å•ï¼ŒFilebeat é»˜è®¤æ”¯æŒ
   - è½¬æ¢å™¨å®Œå…¨å…¼å®¹ Elasticsearch Bulk API

2. **Logstash HTTP è¾“å‡º**
   - å¦‚æœå·²æœ‰ Logstash åŸºç¡€è®¾æ–½
   - é…ç½®ç®€å•

3. **ç›´æ¥ JSON æ¥æ”¶**
   - æœ€çµæ´»
   - å¯ä»¥è‡ªå®šä¹‰æ ¼å¼

### æœªæ¥æ‰©å±•

å¦‚æœéœ€è¦æ”¯æŒå…¶ä»–æ ¼å¼ï¼Œå¯ä»¥ï¼š
1. æ·»åŠ ç›¸åº”çš„ Go åº“ä¾èµ–
2. å®ç°å¯¹åº”çš„å¤„ç†å‡½æ•°
3. æ›´æ–°é…ç½®æ–‡ä»¶

## ğŸ”§ å¦‚ä½•å¯ç”¨å…¶ä»–æ ¼å¼

### å¯ç”¨ Kafka æ”¯æŒ

1. å–æ¶ˆæ³¨é‡Š `go.mod` ä¸­çš„ Kafka ä¾èµ–
2. å®ç° `startKafkaConsumer()` å‡½æ•°
3. åœ¨ `config.yaml` ä¸­å¯ç”¨ Kafka è¾“å…¥

### å¯ç”¨ Redis æ”¯æŒ

1. å–æ¶ˆæ³¨é‡Š `go.mod` ä¸­çš„ Redis ä¾èµ–
2. å®ç° `startRedisConsumer()` å‡½æ•°
3. åœ¨ `config.yaml` ä¸­å¯ç”¨ Redis è¾“å…¥

### å¯ç”¨æ–‡ä»¶ tail æ”¯æŒ

1. å–æ¶ˆæ³¨é‡Š `go.mod` ä¸­çš„ fsnotify ä¾èµ–
2. å®ç° `startFileTail()` å‡½æ•°
3. åœ¨ `config.yaml` ä¸­å¯ç”¨æ–‡ä»¶è¾“å…¥

## âœ… å½“å‰çŠ¶æ€æ€»ç»“

- âœ… **Elasticsearch**: å®Œå…¨æ”¯æŒï¼ˆæ¨èä½¿ç”¨ï¼‰
- âœ… **Logstash HTTP**: å®Œå…¨æ”¯æŒ
- âœ… **ç›´æ¥ JSON**: å®Œå…¨æ”¯æŒ
- ğŸš§ **Logstash TCP**: æ¡†æ¶å·²å‡†å¤‡
- ğŸš§ **Kafka**: æ¡†æ¶å·²å‡†å¤‡
- ğŸš§ **Redis**: æ¡†æ¶å·²å‡†å¤‡
- ğŸš§ **File**: æ¡†æ¶å·²å‡†å¤‡
- ğŸš§ **Console**: éœ€è¦å¤–éƒ¨å·¥å…·é…åˆ

**æ ¸å¿ƒåŠŸèƒ½ï¼ˆElasticsearch è¾“å‡ºï¼‰å·²å®Œå…¨æ”¯æŒï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨ï¼**

